CLIENT_JSON_BENCH_BIN = client_json_bench_bin
SERVER_JSON_BENCH_BIN = server_json_bench_bin
SERVER_JSON_BIN = server_json_bin
CLIENT_GRPC_BENCH_BIN = client_grpc_bench_bin
SERVER_GRPC_BENCH_BIN = server_grpc_bench_bin
SERVER_GRPC_BIN = server_grpc_bin
CLIENT_HTTP_BENCH_BIN = client_http_bench_bin
SERVER_HTTP_BENCH_BIN = server_http_bench_bin

JSON_CLIENT_BENCH_DIR = cmd/json_rpc_client_bench
JSON_SERVER_BENCH_DIR = cmd/json_rpc_server_bench
JSON_SERVER_DIR = cmd/json_rpc_server
GRPC_CLIENT_BENCH_DIR = cmd/grpc_client_bench
GRPC_SERVER_BENCH_DIR = cmd/grpc_server_bench
GRPC_SERVER_DIR = cmd/grpc_server
HTTP_CLIENT_BENCH_DIR = cmd/http_client_bench
HTTP_SERVER_BENCH_DIR = cmd/http_server_bench
GRPC_STORAGE_GENERATED_CODE_PATH = pkg/grpc_storage

JSON_CLIENT_BENCH_FILENAMES =	main.go
JSON_SERVER_BENCH_FILENAMES =	main.go			storage.go
JSON_SERVER_FILENAMES =			main.go			storage.go
GRPC_CLIENT_BENCH_FILENAMES =	main.go
GRPC_SERVER_BENCH_FILENAMES =	main.go			storage.go
GRPC_SERVER_FILENAMES =			main.go			storage.go
HTTP_CLIENT_BENCH_FILENAMES =	main.go
HTTP_SERVER_BENCH_FILENAMES =	main.go			server.go		endpoints.go

JSON_CLIENT_BENCH_FILES = $(addprefix $(JSON_CLIENT_BENCH_DIR)/,$(JSON_CLIENT_BENCH_FILENAMES))
JSON_SERVER_BENCH_FILES = $(addprefix $(JSON_SERVER_BENCH_DIR)/,$(JSON_SERVER_BENCH_FILENAMES))
JSON_SERVER_FILES = $(addprefix $(JSON_SERVER_DIR)/,$(JSON_SERVER_FILENAMES))
GRPC_CLIENT_BENCH_FILES = $(addprefix $(GRPC_CLIENT_BENCH_DIR)/,$(GRPC_CLIENT_BENCH_FILENAMES))
GRPC_SERVER_BENCH_FILES = $(addprefix $(GRPC_SERVER_BENCH_DIR)/,$(GRPC_SERVER_BENCH_FILENAMES))
GRPC_SERVER_FILES = $(addprefix $(GRPC_SERVER_DIR)/,$(GRPC_SERVER_FILENAMES))
HTTP_CLIENT_BENCH_FILES = $(addprefix $(HTTP_CLIENT_BENCH_DIR)/,$(HTTP_CLIENT_BENCH_FILENAMES))
HTTP_SERVER_BENCH_FILES = $(addprefix $(HTTP_SERVER_BENCH_DIR)/,$(HTTP_SERVER_BENCH_FILENAMES))

all: $(CLIENT_JSON_BENCH_BIN) $(SERVER_JSON_BENCH_BIN) $(SERVER_JSON_BIN) $(CLIENT_GRPC_BENCH_BIN) $(SERVER_GRPC_BENCH_BIN) $(SERVER_GRPC_BIN) $(CLIENT_HTTP_BENCH_BIN) $(SERVER_HTTP_BENCH_BIN)

$(CLIENT_JSON_BENCH_BIN):
	go build -o $(CLIENT_JSON_BENCH_BIN) $(JSON_CLIENT_BENCH_FILES)

$(SERVER_JSON_BENCH_BIN):
	go build -o $(SERVER_JSON_BENCH_BIN) $(JSON_SERVER_BENCH_FILES)

$(SERVER_JSON_BIN):
	go build -o $(SERVER_JSON_BIN) $(JSON_SERVER_FILES)

$(CLIENT_GRPC_BENCH_BIN): $(GRPC)
	go build -o $(CLIENT_GRPC_BENCH_BIN) $(GRPC_CLIENT_BENCH_FILES)

$(SERVER_GRPC_BENCH_BIN): $(GRPC)
	go build -o $(SERVER_GRPC_BENCH_BIN) $(GRPC_SERVER_BENCH_FILES)

$(SERVER_GRPC_BIN): $(GRPC)
	go build -o $(SERVER_GRPC_BIN) $(GRPC_SERVER_FILES)

$(CLIENT_HTTP_BENCH_BIN):
	go build -o $(CLIENT_HTTP_BENCH_BIN) $(HTTP_CLIENT_BENCH_FILES)

$(SERVER_HTTP_BENCH_BIN):
	go build -o $(SERVER_HTTP_BENCH_BIN) $(HTTP_SERVER_BENCH_FILES)

$(GRPC): $(GRPC_STORAGE_GENERATED_CODE_PATH)/storage.pb.go
	protoc --go_out=plugins=grpc:$(GRPC_STORAGE_GENERATED_CODE_PATH) storage.proto

fclean:
	rm -rf $(CLIENT_JSON_BENCH_BIN)
	rm -rf $(SERVER_JSON_BENCH_BIN)
	rm -rf $(SERVER_JSON_BIN)
	rm -rf $(CLIENT_GRPC_BENCH_BIN)
	rm -rf $(SERVER_GRPC_BENCH_BIN)
	rm -rf $(SERVER_GRPC_BIN)
	rm -rf $(CLIENT_HTTP_BENCH_BIN)
	rm -rf $(SERVER_HTTP_BENCH_BIN)

re: fclean all
